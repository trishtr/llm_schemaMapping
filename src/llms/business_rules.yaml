# Healthcare Business Rules Configuration
# Comprehensive validation rules and compliance standards for healthcare data mapping

healthcare_business_rules:
  version: "1.0"
  last_updated: "2025-08-21"
  
  # Medical Coding Standards and Validation Rules
  medical_coding_standards:
    icd_10_codes:
      format_pattern: "^[A-Z][0-9]{2}(\\.[0-9A-Z]{1,4})?$"
      examples: ["A00", "B15.9", "Z51.11", "S72.001A"]
      validation_rules:
        - "first_character_must_be_letter"
        - "followed_by_two_digits"
        - "optional_decimal_with_alphanumeric_suffix"
        - "maximum_length_7_characters"
      invalid_patterns: ["^[0-9]", ".*[^A-Z0-9\\.].*"]
      
    icd_9_codes:
      format_pattern: "^([0-9]{3}(\\.[0-9]{1,2})?|V[0-9]{2}(\\.[0-9]{1,2})?|E[0-9]{3}(\\.[0-9])?)"
      examples: ["250.0", "V10.3", "E880.1", "780"]
      status: "legacy_support_only"
      
    cpt_codes:
      format_pattern: "^[0-9]{5}$"
      valid_ranges:
        - "00100-01999" # Anesthesia
        - "10021-69990" # Surgery
        - "70010-79999" # Radiology
        - "80047-89398" # Pathology
        - "90281-99607" # Medicine
      examples: ["99213", "36415", "80053"]
      validation_rules:
        - "exactly_5_digits"
        - "must_be_within_valid_ranges"
        
    hcpcs_codes:
      level_1: "same_as_cpt_codes"
      level_2:
        format_pattern: "^[A-Z][0-9]{4}$"
        examples: ["A0425", "J1100", "L8400"]
        validation_rules:
          - "first_character_letter_A_through_V"
          - "followed_by_four_digits"
          
    ndc_codes:
      format_pattern: "^[0-9]{4,5}-[0-9]{3,4}-[0-9]{1,2}$"
      examples: ["0069-2587-68", "12345-678-90"]
      validation_rules:
        - "three_segment_hyphen_separated"
        - "labeler_code_4_or_5_digits"
        - "product_code_3_or_4_digits"
        - "package_code_1_or_2_digits"

  # Healthcare Identifier Validation Rules
  healthcare_identifiers:
    npi_validation:
      format: "exactly_10_digits"
      algorithm: "luhn_checksum"
      registry_check: "nppes_database"
      examples: ["1234567893", "9876543210"]
      validation_steps:
        - "check_length_equals_10"
        - "verify_all_numeric"
        - "apply_luhn_algorithm"
        - "optional_nppes_lookup"
        
    dea_numbers:
      format_pattern: "^[A-Z]{2}[0-9]{7}$"
      validation_rules:
        - "two_letters_followed_by_seven_digits"
        - "first_letter_indicates_registrant_type"
        - "second_letter_first_letter_of_last_name"
        - "last_digit_is_check_digit"
      registrant_types:
        A: "deprecated"
        B: "hospital_clinic"
        F: "manufacturer"
        G: "researcher"
        H: "teaching_institution"
        L: "reverse_distributor"
        M: "mid_level_practitioner"
        P: "practitioner"
        R: "analytical_lab"
        S: "narcotic_treatment_program"
        T: "teaching_institution"
        U: "practitioner"
        X: "suboxone_prescribing"
        
    medicare_provider_ids:
      legacy_format: "^[0-9]{6}$"
      current_format: "^[0-9]{10}$" # NPI-based
      validation: "transitional_support_both_formats"

  # Clinical Data Validation Rules
  clinical_data_ranges:
    vital_signs:
      systolic_bp:
        minimum: 60
        maximum: 300
        units: "mmHg"
        critical_low: 90
        critical_high: 180
        
      diastolic_bp:
        minimum: 30
        maximum: 200
        units: "mmHg"
        critical_low: 60
        critical_high: 110
        
      heart_rate:
        minimum: 20
        maximum: 250
        units: "bpm"
        age_specific_ranges:
          newborn: "120-160"
          infant: "80-140"
          toddler: "80-130"
          preschool: "80-120"
          school_age: "70-110"
          adult: "60-100"
          
      temperature:
        minimum: 90.0
        maximum: 115.0
        units: "fahrenheit"
        celsius_conversion: true
        critical_low: 95.0
        critical_high: 104.0
        
      weight:
        minimum: 0.5 # kg
        maximum: 1000 # kg
        units: "kg"
        pound_conversion: true
        pediatric_percentiles: true
        
      height:
        minimum: 10 # cm
        maximum: 300 # cm
        units: "cm"
        inch_conversion: true
        
    laboratory_values:
      glucose:
        fasting:
          normal: "70-99 mg/dL"
          prediabetic: "100-125 mg/dL"
          diabetic: ">126 mg/dL"
        random:
          diabetic: ">200 mg/dL"
          
      hemoglobin:
        male: "13.8-17.2 g/dL"
        female: "12.1-15.1 g/dL"
        pediatric_age_ranges: true
        
      creatinine:
        male: "0.74-1.35 mg/dL"
        female: "0.59-1.04 mg/dL"
        age_adjustment: true

  # Financial Data Validation Rules
  financial_validation:
    charge_amounts:
      minimum: 0.01
      maximum: 1000000.00
      currency: "USD"
      decimal_places: 2
      
    copay_amounts:
      typical_range: "0-100"
      maximum: 500
      specialty_variations:
        primary_care: "0-50"
        specialist: "10-75"
        emergency: "50-500"
        
    deductible_amounts:
      individual_maximum: 10000
      family_maximum: 20000
      hsa_compatible_minimum: 1400
      
    out_of_pocket_maximum:
      individual_limit: 15000
      family_limit: 30000
      aca_compliant_limits: true

  # Patient Demographics Validation
  demographic_validation:
    age_ranges:
      newborn: "0-28 days"
      infant: "29 days-1 year"
      toddler: "1-3 years"
      preschool: "4-5 years"
      school_age: "6-12 years"
      adolescent: "13-18 years"
      adult: "19-64 years"
      senior: "65+ years"
      
    gender_codes:
      hl7_administrative_gender:
        - "M" # Male
        - "F" # Female
        - "O" # Other
        - "U" # Unknown
      iso_5218_codes:
        - "0" # Not known
        - "1" # Male
        - "2" # Female
        - "9" # Not applicable
        
    ethnicity_codes:
      hispanic_or_latino:
        - "2135-2" # Hispanic or Latino
        - "2186-5" # Not Hispanic or Latino
        - "UNK" # Unknown
        - "ASKU" # Asked but unknown
        
    race_codes:
      omb_categories:
        - "1002-5" # American Indian or Alaska Native
        - "2028-9" # Asian
        - "2054-5" # Black or African American
        - "2076-8" # Native Hawaiian or Other Pacific Islander
        - "2106-3" # White
        - "UNK" # Unknown
        - "ASKU" # Asked but unknown

  # Regulatory Compliance Rules
  regulatory_compliance:
    hipaa_requirements:
      phi_identifiers:
        direct_identifiers:
          - "names"
          - "postal_address_info"
          - "telephone_numbers"
          - "fax_numbers"
          - "email_addresses"
          - "social_security_numbers"
          - "medical_record_numbers"
          - "health_plan_beneficiary_numbers"
          - "account_numbers"
          - "certificate_license_numbers"
          - "vehicle_identifiers"
          - "device_identifiers"
          - "web_urls"
          - "ip_addresses"
          - "biometric_identifiers"
          - "full_face_photos"
          - "any_other_unique_identifying_number"
          
        quasi_identifiers:
          - "dates_related_to_individual"
          - "geographic_subdivisions_smaller_than_state"
          - "ages_over_89"
          
      safe_harbor_requirements:
        geographic_restriction: "no_geographic_units_smaller_than_state"
        date_restriction: "no_dates_except_year"
        age_restriction: "ages_90_and_over_aggregated"
        
    state_privacy_laws:
      california_ccpa:
        personal_information_categories:
          - "identifiers"
          - "personal_information_categories"
          - "protected_classification_characteristics"
          - "commercial_information"
          - "biometric_information"
          - "internet_activity"
          - "geolocation_data"
          - "sensory_data"
          - "professional_employment_information"
          - "non_public_education_information"
          - "inferences"

  # Data Quality Business Rules
  data_quality_rules:
    completeness_requirements:
      patient_registration:
        required_fields: ["patient_id", "last_name", "first_name", "date_of_birth"]
        recommended_fields: ["gender", "address", "phone", "emergency_contact"]
        
      provider_credentialing:
        required_fields: ["npi", "last_name", "first_name", "primary_specialty"]
        required_documents: ["license", "malpractice_insurance", "board_certification"]
        
      encounter_documentation:
        required_fields: ["encounter_id", "patient_id", "provider_id", "encounter_date", "encounter_type"]
        billing_requirements: ["diagnosis_codes", "procedure_codes", "place_of_service"]
        
    consistency_rules:
      cross_table_validation:
        patient_appointment_consistency:
          - "appointment_patient_id_must_exist_in_patient_table"
          - "appointment_date_cannot_be_before_patient_birth_date"
          - "appointment_date_cannot_be_more_than_1_year_in_future"
          
        provider_appointment_consistency:
          - "appointment_provider_id_must_exist_in_provider_table"
          - "provider_must_be_active_on_appointment_date"
          - "provider_specialty_should_match_appointment_type"
          
        billing_encounter_consistency:
          - "billing_encounter_id_must_exist_in_encounter_table"
          - "billing_date_cannot_be_before_encounter_date"
          - "procedure_codes_must_be_valid_for_encounter_type"

  # Transformation and Standardization Rules
  standardization_rules:
    name_formatting:
      case_rules:
        - "proper_case_for_names"
        - "handle_prefixes_mc_mac_o_appropriately"
        - "preserve_capitalization_for_roman_numerals"
        
      special_characters:
        allowed: ["apostrophe", "hyphen", "space", "period"]
        remove: ["numbers", "symbols_except_allowed"]
        
    address_standardization:
      usps_guidelines:
        - "use_standard_street_abbreviations"
        - "proper_case_for_street_names"
        - "uppercase_for_state_abbreviations"
        - "validate_zip_codes_against_usps_database"
        
    phone_number_formatting:
      domestic_format: "(XXX) XXX-XXXX"
      international_format: "+X XXX XXX XXXX"
      storage_format: "digits_only_with_country_code"
      
    date_standardization:
      input_formats:
        - "MM/DD/YYYY"
        - "MM-DD-YYYY"
        - "YYYY-MM-DD"
        - "DD-MMM-YYYY"
      output_format: "YYYY-MM-DD"
      timezone_handling: "convert_to_facility_timezone"

  # Error Handling and Data Quality Scoring
  error_handling:
    validation_failure_actions:
      critical_errors:
        - "invalid_patient_identifier"
        - "missing_required_phi_consent"
        - "regulatory_compliance_violation"
        action: "reject_record"
        
      warning_level_errors:
        - "missing_recommended_field"
        - "value_outside_expected_range"
        - "format_inconsistency"
        action: "flag_for_review"
        
      informational_notices:
        - "unusual_but_valid_value"
        - "legacy_format_detected"
        action: "log_for_monitoring"
        
    data_quality_scoring:
      completeness_weight: 0.3
      accuracy_weight: 0.25
      consistency_weight: 0.2
      timeliness_weight: 0.15
      validity_weight: 0.1
      
      score_calculation:
        excellent: "95-100%"
        good: "85-94%"
        acceptable: "70-84%"
        poor: "50-69%"
        unacceptable: "below_50%"